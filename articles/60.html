<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"  
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>



<title>
Goodbye UW-imapd, hello Maildir and Courier -- Steve Kehlet's Pages
</title>
<link rel="Stylesheet" href="/style.css" type="text/css" media="screen" />



</head>

<body>

<!-- main layout -->
<table id="main" border="0" cellspacing="0" cellpadding="0">
<tr>

<td id="nav">
<div class="sidebarSheet">
<div id="siteName"><a href="/">Steve Kehlet's Pages</a></div>
<br />
<a href="/docs/about.html">About</a>
</div><!-- sidebarSheet -->


<div class="sidebarSheet">
<form method="get" action="http://www.google.com/search">
<input type="hidden" name="sitesearch" value="www.kehlet.cx" />
<input type="text" name="q" size="16" maxlength="255" />
<input type="submit" name="btnG" value="Search" />
</form>
</div>


<div id="articleListSheet">
<div class="navHeader">Articles:</div>
<div id="navList">
<a href="/articles/197.html">02/24/11: It's Been a While</a><br />
<a href="/articles/196.html">10/29/09: One-Way Notifications to Your ...</a><br />
<a href="/articles/195.html">07/10/09: I &lt;3 Typography</a><br />
<a href="/articles/193.html">03/30/09: Kean Coffee Open in Tustin</a><br />
<a href="/articles/192.html">01/22/09: Here's Your 99 Cents Change...</a><br />
<a href="/articles/190.html">09/18/08: Ruby GD2 and Gradients</a><br />
<a href="/articles/189.html">09/17/08: Crashes Happen At the Worst ...</a><br />
<a href="/articles/188.html">08/28/08: QotD: I think the pressure that...</a><br />
<a href="/articles/187.html">08/14/08: Hello, JRuby Rack and Glass...</a><br />
<a href="/articles/186.html">08/08/08: Handy tcpdump Expression to ...</a><br />
<a href="/articles/185.html">08/07/08: Equal Suffering in JavaScript</a><br />
<a href="/articles/184.html">07/25/08: Latest DNS Cache Poisoning ...</a><br />
<a href="/articles/183.html">07/25/08: Handy Mac OS Instant Diction...</a><br />
<a href="/articles/182.html">07/18/08: My Bloody Valentine are Back</a><br />
<a href="/articles/178.html">06/17/08: Safari + GreaseKit + Auto B...</a><br />
<a href="/articles/174.html">06/16/08: Ruby Sequel</a><br />
<a href="/articles/173.html">04/25/08: JRuby Overview Video</a><br />
<a href="/articles/171.html">04/24/08: Email Subscribers, Please Si...</a><br />
<a href="/articles/169.html">02/29/08: I Hate Date Processing</a><br />
<a href="/articles/168.html">02/27/08: No Pickle</a><br />
<a href="/articles/166.html">02/07/08: 241 Toll Road Expansion Stop...</a><br />
<a href="/articles/163.html">02/04/08: Mail Folders Under Inbox, Pa...</a><br />
<a href="/articles/160.html">12/12/07: Coding Horror</a><br />
<a href="/articles/159.html">12/10/07: Eliminating Vibrant Popup Ads</a><br />
<a href="/articles/158.html">11/02/07: Gmail IMAP and Folders Und...</a><br />
<a href="/articles/157.html">10/26/07: A Thousand (or More!) Words ...</a><br />
<a href="/articles/156.html">09/27/07: iPhone Still Doesn't Play G.7...</a><br />
<a href="/articles/155.html">09/26/07: Mac OS X Mail, iPhone, and ...</a><br />
<a href="/articles/154.html">08/17/07: The Every 55 Minute Cell Ph...</a><br />
<a href="/articles/151.html">05/29/07: Using Google Apps for Spam...</a><br />
<a href="/articles/149.html">05/25/07: Fixing DST on my aging Ope...</a><br />
<a href="/articles/148.html">03/10/07: Annoying &quot;Rapid-Fire&quot; AIM syn...</a><br />
<a href="/articles/147.html">01/04/07: What the Grinch Got Right</a><br />
<a href="/articles/146.html">10/05/06: Meeting Martin Diedrich at Ke...</a><br />
<a href="/articles/145.html">09/20/06: From the entire Diedrich Cof...</a><br />
<a href="/articles/143.html">04/18/06: Stuck With Your Mistakes For...</a><br />
<a href="/articles/142.html">04/15/06: Dishwasher Debacle</a><br />
<a href="/articles/140.html">02/21/06: MacBook Pro is Here!</a><br />
<a href="/articles/138.html">01/04/06: New Powerbook memory works!</a><br />
<a href="/articles/136.html">11/01/05: An Outsourced Life</a><br />
<a href="/articles/135.html">10/28/05: The New &quot;On Call&quot;</a><br />
<a href="/articles/134.html">09/08/05: iPod nano</a><br />
<a href="/articles/131.html">07/10/05: A World of Warcraft Moment</a><br />
<a href="/articles/129.html">06/03/05: Keeping Your SSH Sessions ...</a><br />
<a href="/articles/127.html">05/18/05: When Bees Attack</a><br />
<a href="/articles/124.html">05/17/05: San Diego Trip</a><br />
<a href="/articles/125.html">05/07/05: Garage Wiring Cleanup</a><br />
<a href="/articles/122.html">03/27/05: Spring Ahead, Fall Flat</a><br />
<a href="/articles/121.html">03/27/05: Google woes</a><br />
<a href="/articles/120.html">03/20/05: Knights of the Old Republic II</a><br />
<a href="/articles/118.html">03/20/05: Eternal Sunshine of the Spotl...</a><br />
<a href="/articles/119.html">03/13/05: Shred Fest</a><br />
<a href="/articles/116.html">02/20/05: Web Site Moved (Again)</a><br />
<a href="/articles/112.html">02/17/05: Tivo on the Home Network</a><br />
<a href="/articles/113.html">02/12/05: Half Life 2</a><br />
<a href="/articles/111.html">01/30/05: Home Wiring Project, Part Deux</a><br />
<a href="/articles/110.html">01/09/05: Supersize Your Tivo</a><br />
<a href="/articles/109.html">01/09/05: Holiday Food Photo Roundup</a><br />
<a href="/articles/108.html">01/09/05: The Battle for Middle Earth</a><br />
<a href="/articles/107.html">01/03/05: CAPTCHA</a><br />
<a href="/articles/106.html">12/24/04: Parking Lot Rage</a><br />
<a href="/articles/105.html">12/19/04: The Blither of Earthsea</a><br />
<a href="/articles/99.html">11/09/04: Tuning TCP for High Bandwi...</a><br />
<a href="/articles/102.html">10/31/04: San Andreas</a><br />
<a href="/articles/101.html">10/17/04: The PStwo arrives for Gran...</a><br />
<a href="/articles/100.html">10/17/04: Look ma!  No PHP!</a><br />
<a href="/articles/98.html">10/04/04: I, robot.c</a><br />
<a href="/articles/97.html">09/28/04: Fable</a><br />
<a href="/articles/96.html">09/26/04: Up 401 days!</a><br />
<a href="/articles/95.html">09/26/04: Computer Upgrade Nightmare</a><br />
<a href="/articles/94.html">08/09/04: Beautiful Colorado Country</a><br />
<a href="/articles/93.html">07/25/04: Windows XP: Insecure By Def...</a><br />
<a href="/articles/92.html">07/21/04: Mattern Sausage &amp; Meat</a><br />
<a href="/articles/91.html">07/14/04: Goodbye, D-Link POS-2000 c...</a><br />
<a href="/articles/90.html">07/11/04: Hello, Objective C</a><br />
<a href="/articles/89.html">06/27/04: Le Guin's The Farthest Shore</a><br />
<a href="/articles/88.html">06/20/04: Same Old Stuff, new look and...</a><br />
<a href="/articles/87.html">06/14/04: Ultima V: Revisiting an Old F...</a><br />
<a href="/articles/86.html">05/31/04: Home Wiring Project</a><br />
<a href="/articles/85.html">05/23/04: Goodbye Sendmail, hello Post...</a><br />
<a href="/articles/84.html">04/25/04: Tivo 1 meets Tivo 2</a><br />
<a href="/articles/83.html">04/20/04: Dan Brown's The DaVinci Code</a><br />
<a href="/articles/79.html">03/14/04: Subnetting is Fun</a><br />
<a href="/articles/81.html">03/06/04: What's up with &quot;The Quick Bro...</a><br />
<a href="/articles/80.html">03/06/04: Immortalize your handwriting</a><br />
<a href="/articles/78.html">02/25/04: Web site moved</a><br />
<a href="/articles/77.html">02/14/04: Hacking TCP/IP with tcpping</a><br />
<a href="/articles/76.html">02/07/04: Stopping image leechers</a><br />
<a href="/articles/70.html">02/07/04: Morrowind Modding</a><br />
<a href="/articles/68.html">01/28/04: Infrastructure Guy</a><br />
<a href="/articles/67.html">01/28/04: Brand new year and ...</a><br />
<a href="/articles/66.html">11/28/03: Dan Brown's Angels and Dem...</a><br />
<a href="/articles/65.html">11/28/03: Thanksgiving 2003</a><br />
<a href="/articles/64.html">11/08/03: Knights of the Old Republic</a><br />
<a href="/articles/63.html">11/08/03: 10 years of Linux</a><br />
<a href="/articles/55.html">11/06/03: Morrowind: The (Immersive) Q...</a><br />
<a href="/articles/61.html">09/01/03: Trip to Berkeley</a><br />
<a href="/articles/60.html">08/25/03: Goodbye UW-imapd, hello Maild...</a><br />
<a href="/articles/59.html">08/17/03: Massive Cox Outage</a><br />
<a href="/articles/54.html">07/03/03: The Latest Move in Cox's Ar...</a><br />
<a href="/articles/53.html">05/01/03: Reading Binge, Part II: Rende...</a><br />
<a href="/articles/51.html">04/28/03: Reading Binge, Part I: A Wiza...</a><br />
<a href="/articles/52.html">04/20/03: Fun with Tengwar</a><br />
<a href="/articles/50.html">04/19/03: Crown moulding project</a><br />
<a href="/articles/49.html">04/19/03: One year of Macintosh and M...</a><br />
<a href="/articles/46.html">04/18/03: My new site</a><br />
<a href="/articles/45.html">04/09/03: Weblog development</a><br />
<a href="/articles/19.html">04/09/03: Dual 1Ghz Ultra Sparc III, 2...</a><br />
<a href="/articles/15.html">02/15/03: Guest Room Painted</a><br />
<a href="/articles/14.html">02/15/03: FTC's national &quot;do not call&quot; re...</a><br />
<a href="/articles/13.html">02/15/03: Unix: Quick and easy to install...</a><br />
<a href="/articles/8.html">02/15/03: The Collapse of Inconvenience</a><br />
<a href="/articles/4.html">02/11/03: Primer Goodness</a><br />
<a href="/articles/7.html">01/18/03: Chicken Dinner</a><br />
<a href="/articles/16.html">01/16/03: Water heater disaster</a><br />
</div> <!-- navList -->
</div> <!-- articleListSheet -->



<div id="finePrint">
Steve Kehlet's Pages <br />
Copyright (c) 2003-2014 Steven Kehlet
</div>


</td> <!-- nav -->

<td valign="top"> <!-- content -->

<br />


<div class="newerOlderLinks">
<a href="/articles/61.html">&lt;- 09/01/03: Trip to Berkeley</a>
 &nbsp;&nbsp;&nbsp;&nbsp; | &nbsp;&nbsp;&nbsp;&nbsp; 
<a href="/articles/59.html">08/17/03: Massive Cox Outage -&gt;</a>
</div> <!-- newerOlderLinks -->
<div id="sheet">

<div id="articleHeading">
Goodbye UW-imapd, hello Maildir and Courier
</div>

<div id="articleSubtitle">
Mon Aug 25th 2003, 5:37pm

</div> <!-- articleSubtitle -->
<div id="articleBody">
I've been having some serious problems with my work and home IMAP clients simultaneously
accessing mail on my server at home--they would constantly fight, lose their connections,
and give me grief when sending mail, often resulting in messages being sent repeatedly. 
This has been an ongoing annoyance, and recently has been an increasing source of
embarrassment when friends and colleagues send me replies such as "umm hi, I got 2 surplus
copies of this btw".
<br><br>

It looks to me that the venerable UW imapd is no longer capable of servicing multiple
clients simultaneously to the same mailbox, which is weird, because I've done this very
thing with it for years using what I believe is essentially the same setup as I have now. 
It's hard to imagine the point of making an IMAP server that doesn't properly implement
this very ability that makes IMAP so desirable in the first place.  But... many things
have changed, I have new computers, different mail clients, etc, etc, who knows really
what the problem is anymore.
<br><br>

So after months of putting it off, and having hit yet another rather embarrassing
duplicated email incident in the last few days, I finally bit the bullet and decided it
was time to fix this problem.  Here is my previous setup, a standard, time-tested
configuration:

<ul>
<li>sendmail
<li>mbox-formatted mailboxes
<li>uw-imapd
</ul>

When looking at solutions, I wanted something that would require a few changes as
possible--i.e., I don't want to bounce any mail or end up debugging ongoing problems.  I
thought I'd found a reasonable solution in an imap server called Dkimap, which supported
mbox mailboxes, but my mail clients seemed to have some weird problems with it.  That left
Courier and Cyrus.  Cyrus looked powerful, but way overkill for my needs.  Maybe I'll
consider it next time I deploy an enterprise solution from scratch :-).  Finally, Courier
looked lightweight and clean--and I've been hearing positive reports about it for a long
time--but unfortunately it requires mail to be stored in maildir format.
<br><br>

Now, while I'd rather not switch to maildir, I wasn't completely opposed to it, but even
if I did it presents the next question of how do I get my mail system to deliver to
maildir mailboxes instead of mbox?  Qmail and Postfix can do it, sure, but I didn't really
want to change out my MTA since 1. I've been using sendmail forever and of course 2. this
would be a big pain.  Plus 3. based on prior experiences I don't really like Qmail.  On
the flip side, Postfix looks pretty cool, nice and lightweight--maybe I'll look at it
again sometime in the near future.  But what finally occurred to me was that Procmail
could deliver to maildir mailboxes--and in fact I was already using it!  So here is the
improved setup:

<ul>
<li>sendmail
<li>procmail
<li>maildir-formatted mailboxes
<li>courier imapd
</ul>

Sendmail pipes incoming mail to procmail.  I changed my procmail recipes to deliver to
different locations (under ~/Maildir now instead of ~/mail) and to deliver using maildir
format (by providing trailing '/'s at the end of the foldername).  I converted my mbox
mailboxes to maildir using a script I found on the web (beware, there are some busted ones
out there).  Courier finds the mail, and serves it up.
<br><br>

<b>One week later:</b> so far it's been working absolutely great.  I can finally access my
home email simultaneously from work and home and the two clients don't interfere with each
other.  In fact, as far as I can tell, they get along great.  The problem with sending
duplicate emails has gone away.  And finally--an unexpected bonus--it's a LOT faster.
<br><br>

So thanks for many years of service, UW imapd, but I've had to move on.
</div>
</div> <!-- sheet -->

<br /><br /><br />
<div id="postingsSheet">
<div class="postingHeader">
Visitor comments
</div>
<div class="posting">
<div class="postingHeading">
On Thu Apr 29th 2004, 8:07pm, erikburrows posted:
</div>
<div class="postingBody">
I've been using the IMAP server bundled with RedHat 7.3 for years. It's
probably UW... It's been terribly slow, and I've had the same problem with
concurrent access. I just finished switching to Courier. I used
perfect_maildir to convert, and everything went very smoothly. (Once I
figured out subfolders were named Maildir/.foldername) Now, instead of my
over-taxed server taking up to a minute to load a message, it's almost
instantaneous. Thanks for the inspiration Steve!
</div><!-- postingBody -->
</div><!-- posting -->
<br />
<br />

<div class="posting">
<div class="postingHeading">
On Fri Apr 30th 2004, 10:14am, erikburrows posted:
</div>
<div class="postingBody">
Followup, 12 hours later: Still fast, still good, but one downside: Courier
IMAP-SSL does not seem to be compatable with Evolution! Grrr... I Really
wanted IMAPS for my laptop, when I'm consulting, or going over the air
waves. So, I've been playing with stunnel. It works fairly well, for my
workstation, but crashes Evolution on my laptop. I'll get it worked out
eventually, but why does everything have to be so difficult?!
</div><!-- postingBody -->
</div><!-- posting -->
<br />
<br />

<div class="posting">
<div class="postingHeading">
On Fri Apr 30th 2004, 12:12pm, Steve Kehlet posted:
</div>
<div class="postingBody">
Glad I could be some inspiration...  :-)  Courier has been working well for
me since I installed it.  

<br><br>

I also had problems getting Evolution and courier to work over SSL.  I
found that the default setup, SSL using STARTTLS, did not work.  It's some
kind of evolution problem.  I googled and googled, but to no avail.  What
did work (and is currently working) for me is instead of using STARTTLS,
enable and use imaps on port 993 (IMAPDSSLSTART=YES).  Then in Evolution, I
set my imap host to &lt;hostname&gt;:993, and Use Secure Connection Always
to force it to use imaps instead of starttls.
</div><!-- postingBody -->
</div><!-- posting -->
<br />
<br />

<div class="posting">
<div class="postingHeading">
On Fri Apr 30th 2004, 12:24pm, Steve Kehlet posted:
</div>
<div class="postingBody">
&gt; <i> I Really wanted IMAPS for my laptop, when I'm consulting, or going
over the air waves.</i>

<br><br>

Of course, you could always tunnel your imap and smtp ports over ssh, and
set your mail client to send and receive mail from localhost.  This avoids
the relative nightmare of getting imap and smtp (with the obligatory smtp
authentication to avoid opening up a mail relay) over ssl working.  For
laptops this blows however since every time you turn on your laptop you
have to (re)start your ssh connection.  We've got imap over ssl figured
out--if you or anyone else here figures out an easy way (keyword: easy) to
get sendmail or postfix to use ssl and authenticate, please let me know. 
It's been on my todo list but last time I looked at sendmail it was an
ocean of effort to get this to work :-(.
</div><!-- postingBody -->
</div><!-- posting -->
<br />
<br />

<div class="posting">
<div class="postingHeading">
On Fri Apr 30th 2004, 12:56pm, erikburrows posted:
</div>
<div class="postingBody">
That worked! IMAPDSSLSTART=YES, IMAPDSTARTTLS=NO and TLS_PROTOCOL=SSL2. No
more ugly hack with stunnel! I love encryption. Thanks Steve!
</div><!-- postingBody -->
</div><!-- posting -->
<br />
<br />

</div> <!-- postingsSheet -->
<br />
<br />
<div class="newerOlderLinks">
<a href="/articles/61.html">&lt;- 09/01/03: Trip to Berkeley</a>
 &nbsp;&nbsp;&nbsp;&nbsp; | &nbsp;&nbsp;&nbsp;&nbsp; 
<a href="/articles/59.html">08/17/03: Massive Cox Outage -&gt;</a>
</div> <!-- newerOlderLinks -->


</td> <!-- content -->

</tr>
</table> <!-- main layout -->

<!-- Google Analytics -->
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-3386315-1");
pageTracker._initData();
pageTracker._trackPageview();
</script>

</body>
</html>

<!-- Generated on 2014/09/07 11:29am -->