<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"  
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>



<title>
Goodbye Sendmail, hello Postfix with SSL and SASL -- Steve Kehlet's Pages
</title>
<link rel="Stylesheet" href="/style.css" type="text/css" media="screen" />



</head>

<body>

<!-- main layout -->
<table id="main" border="0" cellspacing="0" cellpadding="0">
<tr>

<td id="nav">
<div class="sidebarSheet">
<div id="siteName"><a href="/">Steve Kehlet's Pages</a></div>
<br />
<a href="/docs/about.html">About</a>
</div><!-- sidebarSheet -->


<div class="sidebarSheet">
<form method="get" action="http://www.google.com/search">
<input type="hidden" name="sitesearch" value="www.kehlet.cx" />
<input type="text" name="q" size="16" maxlength="255" />
<input type="submit" name="btnG" value="Search" />
</form>
</div>


<div id="articleListSheet">
<div class="navHeader">Articles:</div>
<div id="navList">
<a href="/articles/197.html">02/24/11: It's Been a While</a><br />
<a href="/articles/196.html">10/29/09: One-Way Notifications to Your ...</a><br />
<a href="/articles/195.html">07/10/09: I &lt;3 Typography</a><br />
<a href="/articles/193.html">03/30/09: Kean Coffee Open in Tustin</a><br />
<a href="/articles/192.html">01/22/09: Here's Your 99 Cents Change...</a><br />
<a href="/articles/190.html">09/18/08: Ruby GD2 and Gradients</a><br />
<a href="/articles/189.html">09/17/08: Crashes Happen At the Worst ...</a><br />
<a href="/articles/188.html">08/28/08: QotD: I think the pressure that...</a><br />
<a href="/articles/187.html">08/14/08: Hello, JRuby Rack and Glass...</a><br />
<a href="/articles/186.html">08/08/08: Handy tcpdump Expression to ...</a><br />
<a href="/articles/185.html">08/07/08: Equal Suffering in JavaScript</a><br />
<a href="/articles/184.html">07/25/08: Latest DNS Cache Poisoning ...</a><br />
<a href="/articles/183.html">07/25/08: Handy Mac OS Instant Diction...</a><br />
<a href="/articles/182.html">07/18/08: My Bloody Valentine are Back</a><br />
<a href="/articles/178.html">06/17/08: Safari + GreaseKit + Auto B...</a><br />
<a href="/articles/174.html">06/16/08: Ruby Sequel</a><br />
<a href="/articles/173.html">04/25/08: JRuby Overview Video</a><br />
<a href="/articles/171.html">04/24/08: Email Subscribers, Please Si...</a><br />
<a href="/articles/169.html">02/29/08: I Hate Date Processing</a><br />
<a href="/articles/168.html">02/27/08: No Pickle</a><br />
<a href="/articles/166.html">02/07/08: 241 Toll Road Expansion Stop...</a><br />
<a href="/articles/163.html">02/04/08: Mail Folders Under Inbox, Pa...</a><br />
<a href="/articles/160.html">12/12/07: Coding Horror</a><br />
<a href="/articles/159.html">12/10/07: Eliminating Vibrant Popup Ads</a><br />
<a href="/articles/158.html">11/02/07: Gmail IMAP and Folders Und...</a><br />
<a href="/articles/157.html">10/26/07: A Thousand (or More!) Words ...</a><br />
<a href="/articles/156.html">09/27/07: iPhone Still Doesn't Play G.7...</a><br />
<a href="/articles/155.html">09/26/07: Mac OS X Mail, iPhone, and ...</a><br />
<a href="/articles/154.html">08/17/07: The Every 55 Minute Cell Ph...</a><br />
<a href="/articles/151.html">05/29/07: Using Google Apps for Spam...</a><br />
<a href="/articles/149.html">05/25/07: Fixing DST on my aging Ope...</a><br />
<a href="/articles/148.html">03/10/07: Annoying &quot;Rapid-Fire&quot; AIM syn...</a><br />
<a href="/articles/147.html">01/04/07: What the Grinch Got Right</a><br />
<a href="/articles/146.html">10/05/06: Meeting Martin Diedrich at Ke...</a><br />
<a href="/articles/145.html">09/20/06: From the entire Diedrich Cof...</a><br />
<a href="/articles/143.html">04/18/06: Stuck With Your Mistakes For...</a><br />
<a href="/articles/142.html">04/15/06: Dishwasher Debacle</a><br />
<a href="/articles/140.html">02/21/06: MacBook Pro is Here!</a><br />
<a href="/articles/138.html">01/04/06: New Powerbook memory works!</a><br />
<a href="/articles/136.html">11/01/05: An Outsourced Life</a><br />
<a href="/articles/135.html">10/28/05: The New &quot;On Call&quot;</a><br />
<a href="/articles/134.html">09/08/05: iPod nano</a><br />
<a href="/articles/131.html">07/10/05: A World of Warcraft Moment</a><br />
<a href="/articles/129.html">06/03/05: Keeping Your SSH Sessions ...</a><br />
<a href="/articles/127.html">05/18/05: When Bees Attack</a><br />
<a href="/articles/124.html">05/17/05: San Diego Trip</a><br />
<a href="/articles/125.html">05/07/05: Garage Wiring Cleanup</a><br />
<a href="/articles/122.html">03/27/05: Spring Ahead, Fall Flat</a><br />
<a href="/articles/121.html">03/27/05: Google woes</a><br />
<a href="/articles/120.html">03/20/05: Knights of the Old Republic II</a><br />
<a href="/articles/118.html">03/20/05: Eternal Sunshine of the Spotl...</a><br />
<a href="/articles/119.html">03/13/05: Shred Fest</a><br />
<a href="/articles/116.html">02/20/05: Web Site Moved (Again)</a><br />
<a href="/articles/112.html">02/17/05: Tivo on the Home Network</a><br />
<a href="/articles/113.html">02/12/05: Half Life 2</a><br />
<a href="/articles/111.html">01/30/05: Home Wiring Project, Part Deux</a><br />
<a href="/articles/110.html">01/09/05: Supersize Your Tivo</a><br />
<a href="/articles/109.html">01/09/05: Holiday Food Photo Roundup</a><br />
<a href="/articles/108.html">01/09/05: The Battle for Middle Earth</a><br />
<a href="/articles/107.html">01/03/05: CAPTCHA</a><br />
<a href="/articles/106.html">12/24/04: Parking Lot Rage</a><br />
<a href="/articles/105.html">12/19/04: The Blither of Earthsea</a><br />
<a href="/articles/99.html">11/09/04: Tuning TCP for High Bandwi...</a><br />
<a href="/articles/102.html">10/31/04: San Andreas</a><br />
<a href="/articles/101.html">10/17/04: The PStwo arrives for Gran...</a><br />
<a href="/articles/100.html">10/17/04: Look ma!  No PHP!</a><br />
<a href="/articles/98.html">10/04/04: I, robot.c</a><br />
<a href="/articles/97.html">09/28/04: Fable</a><br />
<a href="/articles/96.html">09/26/04: Up 401 days!</a><br />
<a href="/articles/95.html">09/26/04: Computer Upgrade Nightmare</a><br />
<a href="/articles/94.html">08/09/04: Beautiful Colorado Country</a><br />
<a href="/articles/93.html">07/25/04: Windows XP: Insecure By Def...</a><br />
<a href="/articles/92.html">07/21/04: Mattern Sausage &amp; Meat</a><br />
<a href="/articles/91.html">07/14/04: Goodbye, D-Link POS-2000 c...</a><br />
<a href="/articles/90.html">07/11/04: Hello, Objective C</a><br />
<a href="/articles/89.html">06/27/04: Le Guin's The Farthest Shore</a><br />
<a href="/articles/88.html">06/20/04: Same Old Stuff, new look and...</a><br />
<a href="/articles/87.html">06/14/04: Ultima V: Revisiting an Old F...</a><br />
<a href="/articles/86.html">05/31/04: Home Wiring Project</a><br />
<a href="/articles/85.html">05/23/04: Goodbye Sendmail, hello Post...</a><br />
<a href="/articles/84.html">04/25/04: Tivo 1 meets Tivo 2</a><br />
<a href="/articles/83.html">04/20/04: Dan Brown's The DaVinci Code</a><br />
<a href="/articles/79.html">03/14/04: Subnetting is Fun</a><br />
<a href="/articles/81.html">03/06/04: What's up with &quot;The Quick Bro...</a><br />
<a href="/articles/80.html">03/06/04: Immortalize your handwriting</a><br />
<a href="/articles/78.html">02/25/04: Web site moved</a><br />
<a href="/articles/77.html">02/14/04: Hacking TCP/IP with tcpping</a><br />
<a href="/articles/76.html">02/07/04: Stopping image leechers</a><br />
<a href="/articles/70.html">02/07/04: Morrowind Modding</a><br />
<a href="/articles/68.html">01/28/04: Infrastructure Guy</a><br />
<a href="/articles/67.html">01/28/04: Brand new year and ...</a><br />
<a href="/articles/66.html">11/28/03: Dan Brown's Angels and Dem...</a><br />
<a href="/articles/65.html">11/28/03: Thanksgiving 2003</a><br />
<a href="/articles/64.html">11/08/03: Knights of the Old Republic</a><br />
<a href="/articles/63.html">11/08/03: 10 years of Linux</a><br />
<a href="/articles/55.html">11/06/03: Morrowind: The (Immersive) Q...</a><br />
<a href="/articles/61.html">09/01/03: Trip to Berkeley</a><br />
<a href="/articles/60.html">08/25/03: Goodbye UW-imapd, hello Maild...</a><br />
<a href="/articles/59.html">08/17/03: Massive Cox Outage</a><br />
<a href="/articles/54.html">07/03/03: The Latest Move in Cox's Ar...</a><br />
<a href="/articles/53.html">05/01/03: Reading Binge, Part II: Rende...</a><br />
<a href="/articles/51.html">04/28/03: Reading Binge, Part I: A Wiza...</a><br />
<a href="/articles/52.html">04/20/03: Fun with Tengwar</a><br />
<a href="/articles/50.html">04/19/03: Crown moulding project</a><br />
<a href="/articles/49.html">04/19/03: One year of Macintosh and M...</a><br />
<a href="/articles/46.html">04/18/03: My new site</a><br />
<a href="/articles/45.html">04/09/03: Weblog development</a><br />
<a href="/articles/19.html">04/09/03: Dual 1Ghz Ultra Sparc III, 2...</a><br />
<a href="/articles/15.html">02/15/03: Guest Room Painted</a><br />
<a href="/articles/14.html">02/15/03: FTC's national &quot;do not call&quot; re...</a><br />
<a href="/articles/13.html">02/15/03: Unix: Quick and easy to install...</a><br />
<a href="/articles/8.html">02/15/03: The Collapse of Inconvenience</a><br />
<a href="/articles/4.html">02/11/03: Primer Goodness</a><br />
<a href="/articles/7.html">01/18/03: Chicken Dinner</a><br />
<a href="/articles/16.html">01/16/03: Water heater disaster</a><br />
</div> <!-- navList -->
</div> <!-- articleListSheet -->



<div id="finePrint">
Steve Kehlet's Pages <br />
Copyright (c) 2003-2014 Steven Kehlet
</div>


</td> <!-- nav -->

<td valign="top"> <!-- content -->

<br />


<div class="newerOlderLinks">
<a href="/articles/86.html">&lt;- 05/31/04: Home Wiring Project</a>
 &nbsp;&nbsp;&nbsp;&nbsp; | &nbsp;&nbsp;&nbsp;&nbsp; 
<a href="/articles/84.html">04/25/04: Tivo 1 meets Tivo 2 -&gt;</a>
</div> <!-- newerOlderLinks -->
<div id="sheet" style="overflow: hidden">

<div id="articleHeading">
Goodbye Sendmail, hello Postfix with SSL and SASL
</div>

<div id="articleSubtitle">
Sun May 23rd 2004, 7:00pm

</div> <!-- articleSubtitle -->
<div id="articleBody">
<img src="/images/2004/05/postfix_mysza.gif" align="left">

For a while now I've been wanting to set my home mail server up so that I could use it no
matter where I took my laptop.  That is, offer IMAP and SMTP over SSL with all the
necessary authentication to keep my mail private and my mail server from becoming a
spamming relay.  Until now, I've used ssh's port forwarding feature to get access, and
while this is simple and effective, it's annoying to have to remember to fire it up every
time I cracked open my laptop before checking mail.  

<br><br>

A while ago I got Courier IMAP working with SSL, so for that part at least I no longer
needed my ssh tunnel.  But being able to use my mail server as an SMTP relay (without
completely opening it up to the world) is another matter.  So in a comment in <a
href="/?pid=60">Goodbye UW-imapd, hello Maildir and Courier</a>, I whined for someone to
figure out how to easily get an SMTP server--Sendmail, Postfix, whatever--set up with
authentication over SSL.  I'd looked at this in the past with sendmail and it seemed like
a lot of work, e.g. you have to generate all these certificates with OpenSSL, there's this
add-on package to compile in and set up called SASL, etc, etc.

<br><br>

Inspired by my own whining, I recently bumped this up to a higher slot on my todo list,
and finally got it all up and running.  

<br><br>

First, a comment on OpenSSL: for some reason using OpenSSL is far more confusing than it
really needs to be.  It seems no two resources on the web describe the same way to
accomplish anything, which is a shame, because there are really only a handful of tasks
you ever need to do, but given the plethora of options, wrappers, config files, etc., it
gets to be a bit overwhelming.  But it helps to keep thinking at the high-level: at the
heart of it, SSL is just a mechanism that uses public key encryption: given a pair of
keys, one key can decrypt messages encrypted by the other, and vice versa.  The keys are
not identical, they are specially generated, mathematical complements of one another.  You
keep one key absolutely private (your "key"), and make the other public (your
"certificate").  Swapping certificates is enough to allow private communication between
two parties, e.g. for services like HTTP, SMTP, or IMAP.  A certificate authority (CA) is
nothing more than another guy with yet another key pair, but you keep his certificate in
your browser's (or computer's) trusted key ring, and you inherently trust any certificates
he's signed to be who they say they are.  This allows you to be certain of who you're
talking to (e.g. so you don't hand over your credit card info to someone falsely claiming
to be amazon.com).  Web browsers come with a number of CA's certificates built-in, like
Verisign, who charge lots of money to sign people's certificates and guarantee they are
who they say they are. 

<br><br>

The steps I took were as follows: I created my own CA and copied its certificate to my
laptop (and all other computers I had that would be using my mail server).  Then, I
generated a new certificate and key for the host running the mail services.  Finally, I
had the CA sign the new certificate.  Voila--private, trusted communication.  Granted,
figuring out the exact OpenSSL commands to do this took some effort to figure out, but
that's it at a high level.  It almost seems like various installer scripts (e.g. Courier,
FreeBSD's ports system) do us a disservice by hiding the details of all of this by
handling it automatically, generating self-signed keys that are only useful for that one
service, etc.

<br><br>

Next, SASL is an abstraction library for adding authentication to connection oriented
services (despite SASL being one letter different than SSL, the two have nothing to do
with each other).   Last time I looked at it I didn't particularly like it because it
looked like you needed to maintain yet another password database on the system, with its
own commands for adding passwords, yet another password to keep in sync, etc.  What I
found out this time is that it can tie into PAM, and thus simply use your system's
/etc/passwd database for authentication. Of course, with Unix's hashed password scheme you
must have the user's password in clear text to authenticate, so using SASL this way
requires cleartext transmission of the password--and that's why we wrap the SMTP
connection inside SSL to keep it private (and thus I suppose the appeal of a separate SASL
password database, there are auth schemes such as CRAM-MD5 where the password can be sent
encrypted, eliminating the need to wrap it in SSL.  But I'll take having the whole SMTP
conversation wrapped inside SSL for the occasional privacy gained when the other SMTP
server supports SSL (which I've found in my logs is surprisingly often).).

<br><br>

Finally, just to add one more item to the mix, while setting this up I decided it was
finally time to make the switch from Sendmail to Postfix.  Now I like sendmail, I've used
it for years, I've written some pretty complex sendmail rulesets, and at times enjoyed the
flexibility it has given me.  But I had to stop and think about the last time I actually
did anything like this and I realized it's been at least 5 years.  Over the years I've
seen good things about Postfix--mainly, the attraction of fewer exploits than sendmail and
a simpler configuration.  So, now that I have Postfix set up, I agree: it's simpler to
configure, and seems to be working great.  The only "bad" thing about Postfix at the
moment is the SSL STARTTLS code isn't in the main Postfix distro, you have to patch it
(not really a big deal, but the confidence factor would be higher if it were).  I'd write
more about it, but I really haven't had to mess around with it enough to rant or rave
about anything in particular, which I think speaks highly of it.

<br><br>

So it's been a little bit of work to get all this going, but I now have my own CA set up,
have all my clients trusting this new CA, and have Courier and Postfix offering IMAP and
SMTP over SSL (using the same certificate/key pair).  I love it and it works great!  Now
mail on my laptop works the instant it comes out of sleep.  Of course, the devil's in the
details, so here are a few resources I found very helpful out there.  Good luck!

<ul>
<li><a href="http://www.unixpeople.com/HOWTO/postfix.solaris.html">Deploying Postfix on
Solaris</a> <b>*</b> Excellent
<li><a href="http://ezine.daemonnews.org/200306/postfix-sasl.html">Postfix with SASL
Authentication over TLS</a> (<a
href="http://prioris.mini.pw.edu.pl/~gregory/articles/errata.html">Errata</a>)
<li><a href="http://yocum.org/faqs/postfix-tls-sasl.html">Postfix + TLS + SASL on
FreeBSD</a>
<li><a href="http://www.aet.tu-cottbus.de/personen/jaenicke/pfixtls/">Postfix/TLS - A TLS
extension for POSTFIX</a>
<li><a href="http://www.macosxhints.com/article.php?story=20031023144031331">Importing
self-signed SSL certificates into a Mac OS 10.3.x system</a> (be sure to read the comment
"Even Easier way to manager Certificates" for how to use Keychain Access to do this)

</ul>
</div>
</div> <!-- sheet -->

<br /><br /><br />
<div id="postingsSheet">
<div class="postingHeader">
Visitor comments
</div>
<div class="posting">
<div class="postingHeading">
On Wed Dec 14th 2005, 12:11pm, Erik G. Burrows posted:
</div>
<div class="postingBody">
I've had Courier IMAP with SSL for a while, but over the last two days, I
followed your lead with TLS and SASL for Postfix/SMTP. I got it fully
working this morning, and am very happy. No more worrying about fixing the
relay rules every time I change IP addresses, and much better security.
Also, like you, I've seen quite a bit of public SMTP traffic negotiated
over TLS.
</div><!-- postingBody -->
</div><!-- posting -->
<br />
<br />

<div class="posting">
<div class="postingHeading">
On Mon Dec 19th 2005, 10:57am, Steve Kehlet posted:
</div>
<div class="postingBody">
Cool, glad it's working for you!  I love the setup... I wake up my laptop
and never have to change anything.
</div><!-- postingBody -->
</div><!-- posting -->
<br />
<br />

</div> <!-- postingsSheet -->
<br />
<br />
<div class="newerOlderLinks">
<a href="/articles/86.html">&lt;- 05/31/04: Home Wiring Project</a>
 &nbsp;&nbsp;&nbsp;&nbsp; | &nbsp;&nbsp;&nbsp;&nbsp; 
<a href="/articles/84.html">04/25/04: Tivo 1 meets Tivo 2 -&gt;</a>
</div> <!-- newerOlderLinks -->


</td> <!-- content -->

</tr>
</table> <!-- main layout -->

<!-- Google Analytics -->
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-3386315-1");
pageTracker._initData();
pageTracker._trackPageview();
</script>

</body>
</html>

<!-- Generated on 2014/09/07 11:29am -->