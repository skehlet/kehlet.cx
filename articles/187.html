<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"  
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>



<title>
Hello, JRuby Rack and Glassfish -- Steve Kehlet's Pages
</title>
<link rel="Stylesheet" href="/style.css" type="text/css" media="screen" />



</head>

<body>

<!-- main layout -->
<table id="main" border="0" cellspacing="0" cellpadding="0">
<tr>

<td id="nav">
<div class="sidebarSheet">
<div id="siteName"><a href="/">Steve Kehlet's Pages</a></div>
<br />
<a href="/docs/about.html">About</a>
</div><!-- sidebarSheet -->


<div class="sidebarSheet">
<form method="get" action="http://www.google.com/search">
<input type="hidden" name="sitesearch" value="www.kehlet.cx" />
<input type="text" name="q" size="16" maxlength="255" />
<input type="submit" name="btnG" value="Search" />
</form>
</div>


<div id="articleListSheet">
<div class="navHeader">Articles:</div>
<div id="navList">
<a href="/articles/197.html">02/24/11: It's Been a While</a><br />
<a href="/articles/196.html">10/29/09: One-Way Notifications to Your ...</a><br />
<a href="/articles/195.html">07/10/09: I &lt;3 Typography</a><br />
<a href="/articles/193.html">03/30/09: Kean Coffee Open in Tustin</a><br />
<a href="/articles/192.html">01/22/09: Here's Your 99 Cents Change...</a><br />
<a href="/articles/190.html">09/18/08: Ruby GD2 and Gradients</a><br />
<a href="/articles/189.html">09/17/08: Crashes Happen At the Worst ...</a><br />
<a href="/articles/188.html">08/28/08: QotD: I think the pressure that...</a><br />
<a href="/articles/187.html">08/14/08: Hello, JRuby Rack and Glass...</a><br />
<a href="/articles/186.html">08/08/08: Handy tcpdump Expression to ...</a><br />
<a href="/articles/185.html">08/07/08: Equal Suffering in JavaScript</a><br />
<a href="/articles/184.html">07/25/08: Latest DNS Cache Poisoning ...</a><br />
<a href="/articles/183.html">07/25/08: Handy Mac OS Instant Diction...</a><br />
<a href="/articles/182.html">07/18/08: My Bloody Valentine are Back</a><br />
<a href="/articles/178.html">06/17/08: Safari + GreaseKit + Auto B...</a><br />
<a href="/articles/174.html">06/16/08: Ruby Sequel</a><br />
<a href="/articles/173.html">04/25/08: JRuby Overview Video</a><br />
<a href="/articles/171.html">04/24/08: Email Subscribers, Please Si...</a><br />
<a href="/articles/169.html">02/29/08: I Hate Date Processing</a><br />
<a href="/articles/168.html">02/27/08: No Pickle</a><br />
<a href="/articles/166.html">02/07/08: 241 Toll Road Expansion Stop...</a><br />
<a href="/articles/163.html">02/04/08: Mail Folders Under Inbox, Pa...</a><br />
<a href="/articles/160.html">12/12/07: Coding Horror</a><br />
<a href="/articles/159.html">12/10/07: Eliminating Vibrant Popup Ads</a><br />
<a href="/articles/158.html">11/02/07: Gmail IMAP and Folders Und...</a><br />
<a href="/articles/157.html">10/26/07: A Thousand (or More!) Words ...</a><br />
<a href="/articles/156.html">09/27/07: iPhone Still Doesn't Play G.7...</a><br />
<a href="/articles/155.html">09/26/07: Mac OS X Mail, iPhone, and ...</a><br />
<a href="/articles/154.html">08/17/07: The Every 55 Minute Cell Ph...</a><br />
<a href="/articles/151.html">05/29/07: Using Google Apps for Spam...</a><br />
<a href="/articles/149.html">05/25/07: Fixing DST on my aging Ope...</a><br />
<a href="/articles/148.html">03/10/07: Annoying &quot;Rapid-Fire&quot; AIM syn...</a><br />
<a href="/articles/147.html">01/04/07: What the Grinch Got Right</a><br />
<a href="/articles/146.html">10/05/06: Meeting Martin Diedrich at Ke...</a><br />
<a href="/articles/145.html">09/20/06: From the entire Diedrich Cof...</a><br />
<a href="/articles/143.html">04/18/06: Stuck With Your Mistakes For...</a><br />
<a href="/articles/142.html">04/15/06: Dishwasher Debacle</a><br />
<a href="/articles/140.html">02/21/06: MacBook Pro is Here!</a><br />
<a href="/articles/138.html">01/04/06: New Powerbook memory works!</a><br />
<a href="/articles/136.html">11/01/05: An Outsourced Life</a><br />
<a href="/articles/135.html">10/28/05: The New &quot;On Call&quot;</a><br />
<a href="/articles/134.html">09/08/05: iPod nano</a><br />
<a href="/articles/131.html">07/10/05: A World of Warcraft Moment</a><br />
<a href="/articles/129.html">06/03/05: Keeping Your SSH Sessions ...</a><br />
<a href="/articles/127.html">05/18/05: When Bees Attack</a><br />
<a href="/articles/124.html">05/17/05: San Diego Trip</a><br />
<a href="/articles/125.html">05/07/05: Garage Wiring Cleanup</a><br />
<a href="/articles/122.html">03/27/05: Spring Ahead, Fall Flat</a><br />
<a href="/articles/121.html">03/27/05: Google woes</a><br />
<a href="/articles/120.html">03/20/05: Knights of the Old Republic II</a><br />
<a href="/articles/118.html">03/20/05: Eternal Sunshine of the Spotl...</a><br />
<a href="/articles/119.html">03/13/05: Shred Fest</a><br />
<a href="/articles/116.html">02/20/05: Web Site Moved (Again)</a><br />
<a href="/articles/112.html">02/17/05: Tivo on the Home Network</a><br />
<a href="/articles/113.html">02/12/05: Half Life 2</a><br />
<a href="/articles/111.html">01/30/05: Home Wiring Project, Part Deux</a><br />
<a href="/articles/110.html">01/09/05: Supersize Your Tivo</a><br />
<a href="/articles/109.html">01/09/05: Holiday Food Photo Roundup</a><br />
<a href="/articles/108.html">01/09/05: The Battle for Middle Earth</a><br />
<a href="/articles/107.html">01/03/05: CAPTCHA</a><br />
<a href="/articles/106.html">12/24/04: Parking Lot Rage</a><br />
<a href="/articles/105.html">12/19/04: The Blither of Earthsea</a><br />
<a href="/articles/99.html">11/09/04: Tuning TCP for High Bandwi...</a><br />
<a href="/articles/102.html">10/31/04: San Andreas</a><br />
<a href="/articles/101.html">10/17/04: The PStwo arrives for Gran...</a><br />
<a href="/articles/100.html">10/17/04: Look ma!  No PHP!</a><br />
<a href="/articles/98.html">10/04/04: I, robot.c</a><br />
<a href="/articles/97.html">09/28/04: Fable</a><br />
<a href="/articles/96.html">09/26/04: Up 401 days!</a><br />
<a href="/articles/95.html">09/26/04: Computer Upgrade Nightmare</a><br />
<a href="/articles/94.html">08/09/04: Beautiful Colorado Country</a><br />
<a href="/articles/93.html">07/25/04: Windows XP: Insecure By Def...</a><br />
<a href="/articles/92.html">07/21/04: Mattern Sausage &amp; Meat</a><br />
<a href="/articles/91.html">07/14/04: Goodbye, D-Link POS-2000 c...</a><br />
<a href="/articles/90.html">07/11/04: Hello, Objective C</a><br />
<a href="/articles/89.html">06/27/04: Le Guin's The Farthest Shore</a><br />
<a href="/articles/88.html">06/20/04: Same Old Stuff, new look and...</a><br />
<a href="/articles/87.html">06/14/04: Ultima V: Revisiting an Old F...</a><br />
<a href="/articles/86.html">05/31/04: Home Wiring Project</a><br />
<a href="/articles/85.html">05/23/04: Goodbye Sendmail, hello Post...</a><br />
<a href="/articles/84.html">04/25/04: Tivo 1 meets Tivo 2</a><br />
<a href="/articles/83.html">04/20/04: Dan Brown's The DaVinci Code</a><br />
<a href="/articles/79.html">03/14/04: Subnetting is Fun</a><br />
<a href="/articles/81.html">03/06/04: What's up with &quot;The Quick Bro...</a><br />
<a href="/articles/80.html">03/06/04: Immortalize your handwriting</a><br />
<a href="/articles/78.html">02/25/04: Web site moved</a><br />
<a href="/articles/77.html">02/14/04: Hacking TCP/IP with tcpping</a><br />
<a href="/articles/76.html">02/07/04: Stopping image leechers</a><br />
<a href="/articles/70.html">02/07/04: Morrowind Modding</a><br />
<a href="/articles/68.html">01/28/04: Infrastructure Guy</a><br />
<a href="/articles/67.html">01/28/04: Brand new year and ...</a><br />
<a href="/articles/66.html">11/28/03: Dan Brown's Angels and Dem...</a><br />
<a href="/articles/65.html">11/28/03: Thanksgiving 2003</a><br />
<a href="/articles/64.html">11/08/03: Knights of the Old Republic</a><br />
<a href="/articles/63.html">11/08/03: 10 years of Linux</a><br />
<a href="/articles/55.html">11/06/03: Morrowind: The (Immersive) Q...</a><br />
<a href="/articles/61.html">09/01/03: Trip to Berkeley</a><br />
<a href="/articles/60.html">08/25/03: Goodbye UW-imapd, hello Maild...</a><br />
<a href="/articles/59.html">08/17/03: Massive Cox Outage</a><br />
<a href="/articles/54.html">07/03/03: The Latest Move in Cox's Ar...</a><br />
<a href="/articles/53.html">05/01/03: Reading Binge, Part II: Rende...</a><br />
<a href="/articles/51.html">04/28/03: Reading Binge, Part I: A Wiza...</a><br />
<a href="/articles/52.html">04/20/03: Fun with Tengwar</a><br />
<a href="/articles/50.html">04/19/03: Crown moulding project</a><br />
<a href="/articles/49.html">04/19/03: One year of Macintosh and M...</a><br />
<a href="/articles/46.html">04/18/03: My new site</a><br />
<a href="/articles/45.html">04/09/03: Weblog development</a><br />
<a href="/articles/19.html">04/09/03: Dual 1Ghz Ultra Sparc III, 2...</a><br />
<a href="/articles/15.html">02/15/03: Guest Room Painted</a><br />
<a href="/articles/14.html">02/15/03: FTC's national &quot;do not call&quot; re...</a><br />
<a href="/articles/13.html">02/15/03: Unix: Quick and easy to install...</a><br />
<a href="/articles/8.html">02/15/03: The Collapse of Inconvenience</a><br />
<a href="/articles/4.html">02/11/03: Primer Goodness</a><br />
<a href="/articles/7.html">01/18/03: Chicken Dinner</a><br />
<a href="/articles/16.html">01/16/03: Water heater disaster</a><br />
</div> <!-- navList -->
</div> <!-- articleListSheet -->

<p>
<a href="http://validator.w3.org/check?uri=referer"><img
   src="http://www.w3.org/Icons/valid-xhtml10"
   alt="Valid XHTML 1.0!" height="31" width="88" /></a>
</p>

<div id="finePrint">
Steve Kehlet's Pages <br />
Copyright (c) 2003-2014 Steven Kehlet
</div>


</td> <!-- nav -->

<td valign="top"> <!-- content -->

<br />


<div class="newerOlderLinks">
<a href="/articles/188.html">&lt;- 08/28/08: QotD: I think the pressure that...</a>
 &nbsp;&nbsp;&nbsp;&nbsp; | &nbsp;&nbsp;&nbsp;&nbsp; 
<a href="/articles/186.html">08/08/08: Handy tcpdump Expression to ... -&gt;</a>
</div> <!-- newerOlderLinks -->
<div id="sheet">

<div id="articleHeading">
Hello, JRuby Rack and Glassfish
</div>

<div id="articleSubtitle">
Thu Aug 14th 2008, 2:29pm

</div> <!-- articleSubtitle -->
<div id="articleBody">
<a href="http://rack.rubyforge.org/">Rack</a> "provides an minimal interface between
webservers supporting Ruby and Ruby frameworks" and <a
href="http://wiki.jruby.org/wiki/JRuby_Rack">JRuby Rack</a> is its logical extension to
Java servlet containers.  The latter states "JRuby-Rack supports Rails, Merb, <i>as well
as any Rack-compatible Ruby web framework.</i>"  While <a
href="http://wiki.jruby.org/wiki/Warbler">Warbler</a> makes deploying Rails apps to
Glassfish and other Java servlet containers easier than ever, there are scant few (or at
least, none I could find) examples of deploying any old Rack-based Ruby web application to
Glassfish.  So here's what I figured out.

<br />
<br />

Basically, create a war file with a web.xml, jruby-complete-1.1.3.jar, and
jruby-rack-0.9.1.jar.  Here's the directory structure I used to build the war:

<pre class="prettyprint">
$ find .
.
./WEB-INF
./WEB-INF/lib
./WEB-INF/lib/jruby-complete-1.1.3.jar
./WEB-INF/lib/jruby-rack-0.9.1.jar
./WEB-INF/web.xml
</pre>

Grab a <a
href="http://repository.codehaus.org/org/jruby/jruby-complete/1.1.3/jruby-complete-1.1.3.jar">precompiled
version of jruby-complete-1.1.3.jar</a> or <a
href="http://www.ruby-forum.com/topic/160345">follow these instructions</a> to build it
from the <a href="http://dist.codehaus.org/jruby/">source</a>.  Likewise, grab <a
href="http://repository.codehaus.org/org/jruby/rack/jruby-rack/0.9.1/">jruby-rack-0.9.1.jar</a>.
 (I had local copies of both from using Warbler to build a war for one of my Rails apps,
look around).

<br />
<br />

Here's the "tricky" part, the web.xml, with the interesting parts in red:

<br />
<br />

<code>
&lt;!DOCTYPE&nbsp;web-app&nbsp;PUBLIC<br />
&nbsp;&nbsp;"-//Sun&nbsp;Microsystems,&nbsp;Inc.//DTD&nbsp;Web&nbsp;Application&nbsp;2.3//EN"<br
/>
&nbsp;&nbsp;"http://java.sun.com/dtd/web-app_2_3.dtd"&gt;<br />
&lt;web-app&gt;<br />
<br />
&nbsp;&nbsp;&lt;context-param&gt;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;param-name&gt;public.root&lt;/param-name&gt;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;param-value&gt;/&lt;/param-value&gt;<br />
&nbsp;&nbsp;&lt;/context-param&gt;<br />
<br />
&nbsp;&nbsp;&lt;context-param&gt;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;param-name&gt;<span style="color:
red">rackup</span>&lt;/param-name&gt;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;param-value&gt;<br />
<span style="color: red">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app&nbsp;=&nbsp;lambda&nbsp;{&nbsp;|env|&nbsp;[200,&nbsp;{},&nbsp;'Hello&nbsp;World!']&nbsp;}&nbsp;<br
/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;run&nbsp;app<br />
</span>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/param-value&gt;<br />
&nbsp;&nbsp;&lt;/context-param&gt;<br />
<br />
<br />
&nbsp;&nbsp;&lt;filter&gt;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;filter-name&gt;RackFilter&lt;/filter-name&gt;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;filter-class&gt;org.jruby.rack.RackFilter&lt;/filter-class&gt;<br
/>
&nbsp;&nbsp;&lt;/filter&gt;<br />
&nbsp;&nbsp;&lt;filter-mapping&gt;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;filter-name&gt;RackFilter&lt;/filter-name&gt;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;url-pattern&gt;/*&lt;/url-pattern&gt;<br />
&nbsp;&nbsp;&lt;/filter-mapping&gt;<br />
<br />
&nbsp;&nbsp;&lt;listener&gt;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;listener-class&gt;<span style="color:
red">org.jruby.rack.RackServletContextListener</span>&lt;/listener-class&gt;<br />
&nbsp;&nbsp;&lt;/listener&gt;<br />
<br />
&lt;/web-app&gt;<br />
</code>

<br />
<br />

The <code>rackup</code> parameter is the key, it glues the servlet to your backend
application (I see in the TODO is to allow this script to be defined in a file instead of
in the web.xml).  The value of the parameter is a simple Rack-compliant application,
borrowed from <a href="http://yeahnah.org/files/rack-presentation-oct-07.pdf">this Rack
presentation</a>.

<br />
<br />

You can build a war from this:

<pre>
$ jar cvf ../test.war
*added manifest
adding: WEB-INF/(in = 0) (out= 0)(stored 0%)
adding: WEB-INF/lib/(in = 0) (out= 0)(stored 0%)
adding: WEB-INF/lib/jruby-complete-1.1.3.jar(in = 7341701) (out= 6541093)(deflated 10%)
adding: WEB-INF/lib/jruby-rack-0.9.1.jar(in = 192848) (out= 53055)(deflated 72%)
adding: WEB-INF/web.xml(in = 794) (out= 351)(deflated 55%)
</pre>

and deploy it to your favorite Java servlet container.  Hit it with your browser and you
should see "Hello World!"  It's amazing, it just works.

<br />
<br />

Baby steps!  Next to figure out is how to get a full Rack-compliant app, like something
built using <a href="http://ramaze.net/">Ramaze</a>, running in Glassfish.

<br />
<br />

Thanks go to <a
href="http://www.gittr.com/index.php/archive/jruby-rack-doesnt-work-with-sinatra/">this
post</a>, which was very helpful in figuring out what to do.
</div>
</div> <!-- sheet -->

<br /><br /><br />
<div id="postingsSheet">
<div class="postingHeader">
Visitor comments
</div>
<div class="posting">
<div class="postingHeading">
On Tue Aug 26th 2008, 8:22am, Chris Schneider posted:
</div>
<div class="postingBody">
Thanks for the link to my blog (http://www.gittr.com). I haven't gotten
around to writing a post about it, but Nick Sieger (the jruby-rack
maintainer) added a patch that fixed the issue I was running into with
Sinatra.  $0 is now set to the .xml file, or something along those lines. 
<br />

</div><!-- postingBody -->
</div><!-- posting -->
<br />
<br />

</div> <!-- postingsSheet -->
<br />
<br />
<div class="newerOlderLinks">
<a href="/articles/188.html">&lt;- 08/28/08: QotD: I think the pressure that...</a>
 &nbsp;&nbsp;&nbsp;&nbsp; | &nbsp;&nbsp;&nbsp;&nbsp; 
<a href="/articles/186.html">08/08/08: Handy tcpdump Expression to ... -&gt;</a>
</div> <!-- newerOlderLinks -->


</td> <!-- content -->

</tr>
</table> <!-- main layout -->

<!-- Google Analytics -->
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-3386315-1");
pageTracker._initData();
pageTracker._trackPageview();
</script>

</body>
</html>

<!-- Generated on 2014/09/07 11:29am -->