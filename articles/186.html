<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"  
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>



<title>
Handy tcpdump Expression to Gather CDP Information -- Steve Kehlet's Pages
</title>
<link rel="Stylesheet" href="/style.css" type="text/css" media="screen" />



</head>

<body>

<!-- main layout -->
<table id="main" border="0" cellspacing="0" cellpadding="0">
<tr>

<td id="nav">
<div class="sidebarSheet">
<div id="siteName"><a href="/">Steve Kehlet's Pages</a></div>
<br />
<a href="/docs/about.html">About</a>
</div><!-- sidebarSheet -->


<div class="sidebarSheet">
<form method="get" action="http://www.google.com/search">
<input type="hidden" name="sitesearch" value="www.kehlet.cx" />
<input type="text" name="q" size="16" maxlength="255" />
<input type="submit" name="btnG" value="Search" />
</form>
</div>


<div id="articleListSheet">
<div class="navHeader">Articles:</div>
<div id="navList">
<a href="/articles/197.html">02/24/11: It's Been a While</a><br />
<a href="/articles/196.html">10/29/09: One-Way Notifications to Your ...</a><br />
<a href="/articles/195.html">07/10/09: I &lt;3 Typography</a><br />
<a href="/articles/193.html">03/30/09: Kean Coffee Open in Tustin</a><br />
<a href="/articles/192.html">01/22/09: Here's Your 99 Cents Change...</a><br />
<a href="/articles/190.html">09/18/08: Ruby GD2 and Gradients</a><br />
<a href="/articles/189.html">09/17/08: Crashes Happen At the Worst ...</a><br />
<a href="/articles/188.html">08/28/08: QotD: I think the pressure that...</a><br />
<a href="/articles/187.html">08/14/08: Hello, JRuby Rack and Glass...</a><br />
<a href="/articles/186.html">08/08/08: Handy tcpdump Expression to ...</a><br />
<a href="/articles/185.html">08/07/08: Equal Suffering in JavaScript</a><br />
<a href="/articles/184.html">07/25/08: Latest DNS Cache Poisoning ...</a><br />
<a href="/articles/183.html">07/25/08: Handy Mac OS Instant Diction...</a><br />
<a href="/articles/182.html">07/18/08: My Bloody Valentine are Back</a><br />
<a href="/articles/178.html">06/17/08: Safari + GreaseKit + Auto B...</a><br />
<a href="/articles/174.html">06/16/08: Ruby Sequel</a><br />
<a href="/articles/173.html">04/25/08: JRuby Overview Video</a><br />
<a href="/articles/171.html">04/24/08: Email Subscribers, Please Si...</a><br />
<a href="/articles/169.html">02/29/08: I Hate Date Processing</a><br />
<a href="/articles/168.html">02/27/08: No Pickle</a><br />
<a href="/articles/166.html">02/07/08: 241 Toll Road Expansion Stop...</a><br />
<a href="/articles/163.html">02/04/08: Mail Folders Under Inbox, Pa...</a><br />
<a href="/articles/160.html">12/12/07: Coding Horror</a><br />
<a href="/articles/159.html">12/10/07: Eliminating Vibrant Popup Ads</a><br />
<a href="/articles/158.html">11/02/07: Gmail IMAP and Folders Und...</a><br />
<a href="/articles/157.html">10/26/07: A Thousand (or More!) Words ...</a><br />
<a href="/articles/156.html">09/27/07: iPhone Still Doesn't Play G.7...</a><br />
<a href="/articles/155.html">09/26/07: Mac OS X Mail, iPhone, and ...</a><br />
<a href="/articles/154.html">08/17/07: The Every 55 Minute Cell Ph...</a><br />
<a href="/articles/151.html">05/29/07: Using Google Apps for Spam...</a><br />
<a href="/articles/149.html">05/25/07: Fixing DST on my aging Ope...</a><br />
<a href="/articles/148.html">03/10/07: Annoying &quot;Rapid-Fire&quot; AIM syn...</a><br />
<a href="/articles/147.html">01/04/07: What the Grinch Got Right</a><br />
<a href="/articles/146.html">10/05/06: Meeting Martin Diedrich at Ke...</a><br />
<a href="/articles/145.html">09/20/06: From the entire Diedrich Cof...</a><br />
<a href="/articles/143.html">04/18/06: Stuck With Your Mistakes For...</a><br />
<a href="/articles/142.html">04/15/06: Dishwasher Debacle</a><br />
<a href="/articles/140.html">02/21/06: MacBook Pro is Here!</a><br />
<a href="/articles/138.html">01/04/06: New Powerbook memory works!</a><br />
<a href="/articles/136.html">11/01/05: An Outsourced Life</a><br />
<a href="/articles/135.html">10/28/05: The New &quot;On Call&quot;</a><br />
<a href="/articles/134.html">09/08/05: iPod nano</a><br />
<a href="/articles/131.html">07/10/05: A World of Warcraft Moment</a><br />
<a href="/articles/129.html">06/03/05: Keeping Your SSH Sessions ...</a><br />
<a href="/articles/127.html">05/18/05: When Bees Attack</a><br />
<a href="/articles/124.html">05/17/05: San Diego Trip</a><br />
<a href="/articles/125.html">05/07/05: Garage Wiring Cleanup</a><br />
<a href="/articles/122.html">03/27/05: Spring Ahead, Fall Flat</a><br />
<a href="/articles/121.html">03/27/05: Google woes</a><br />
<a href="/articles/120.html">03/20/05: Knights of the Old Republic II</a><br />
<a href="/articles/118.html">03/20/05: Eternal Sunshine of the Spotl...</a><br />
<a href="/articles/119.html">03/13/05: Shred Fest</a><br />
<a href="/articles/116.html">02/20/05: Web Site Moved (Again)</a><br />
<a href="/articles/112.html">02/17/05: Tivo on the Home Network</a><br />
<a href="/articles/113.html">02/12/05: Half Life 2</a><br />
<a href="/articles/111.html">01/30/05: Home Wiring Project, Part Deux</a><br />
<a href="/articles/110.html">01/09/05: Supersize Your Tivo</a><br />
<a href="/articles/109.html">01/09/05: Holiday Food Photo Roundup</a><br />
<a href="/articles/108.html">01/09/05: The Battle for Middle Earth</a><br />
<a href="/articles/107.html">01/03/05: CAPTCHA</a><br />
<a href="/articles/106.html">12/24/04: Parking Lot Rage</a><br />
<a href="/articles/105.html">12/19/04: The Blither of Earthsea</a><br />
<a href="/articles/99.html">11/09/04: Tuning TCP for High Bandwi...</a><br />
<a href="/articles/102.html">10/31/04: San Andreas</a><br />
<a href="/articles/101.html">10/17/04: The PStwo arrives for Gran...</a><br />
<a href="/articles/100.html">10/17/04: Look ma!  No PHP!</a><br />
<a href="/articles/98.html">10/04/04: I, robot.c</a><br />
<a href="/articles/97.html">09/28/04: Fable</a><br />
<a href="/articles/96.html">09/26/04: Up 401 days!</a><br />
<a href="/articles/95.html">09/26/04: Computer Upgrade Nightmare</a><br />
<a href="/articles/94.html">08/09/04: Beautiful Colorado Country</a><br />
<a href="/articles/93.html">07/25/04: Windows XP: Insecure By Def...</a><br />
<a href="/articles/92.html">07/21/04: Mattern Sausage &amp; Meat</a><br />
<a href="/articles/91.html">07/14/04: Goodbye, D-Link POS-2000 c...</a><br />
<a href="/articles/90.html">07/11/04: Hello, Objective C</a><br />
<a href="/articles/89.html">06/27/04: Le Guin's The Farthest Shore</a><br />
<a href="/articles/88.html">06/20/04: Same Old Stuff, new look and...</a><br />
<a href="/articles/87.html">06/14/04: Ultima V: Revisiting an Old F...</a><br />
<a href="/articles/86.html">05/31/04: Home Wiring Project</a><br />
<a href="/articles/85.html">05/23/04: Goodbye Sendmail, hello Post...</a><br />
<a href="/articles/84.html">04/25/04: Tivo 1 meets Tivo 2</a><br />
<a href="/articles/83.html">04/20/04: Dan Brown's The DaVinci Code</a><br />
<a href="/articles/79.html">03/14/04: Subnetting is Fun</a><br />
<a href="/articles/81.html">03/06/04: What's up with &quot;The Quick Bro...</a><br />
<a href="/articles/80.html">03/06/04: Immortalize your handwriting</a><br />
<a href="/articles/78.html">02/25/04: Web site moved</a><br />
<a href="/articles/77.html">02/14/04: Hacking TCP/IP with tcpping</a><br />
<a href="/articles/76.html">02/07/04: Stopping image leechers</a><br />
<a href="/articles/70.html">02/07/04: Morrowind Modding</a><br />
<a href="/articles/68.html">01/28/04: Infrastructure Guy</a><br />
<a href="/articles/67.html">01/28/04: Brand new year and ...</a><br />
<a href="/articles/66.html">11/28/03: Dan Brown's Angels and Dem...</a><br />
<a href="/articles/65.html">11/28/03: Thanksgiving 2003</a><br />
<a href="/articles/64.html">11/08/03: Knights of the Old Republic</a><br />
<a href="/articles/63.html">11/08/03: 10 years of Linux</a><br />
<a href="/articles/55.html">11/06/03: Morrowind: The (Immersive) Q...</a><br />
<a href="/articles/61.html">09/01/03: Trip to Berkeley</a><br />
<a href="/articles/60.html">08/25/03: Goodbye UW-imapd, hello Maild...</a><br />
<a href="/articles/59.html">08/17/03: Massive Cox Outage</a><br />
<a href="/articles/54.html">07/03/03: The Latest Move in Cox's Ar...</a><br />
<a href="/articles/53.html">05/01/03: Reading Binge, Part II: Rende...</a><br />
<a href="/articles/51.html">04/28/03: Reading Binge, Part I: A Wiza...</a><br />
<a href="/articles/52.html">04/20/03: Fun with Tengwar</a><br />
<a href="/articles/50.html">04/19/03: Crown moulding project</a><br />
<a href="/articles/49.html">04/19/03: One year of Macintosh and M...</a><br />
<a href="/articles/46.html">04/18/03: My new site</a><br />
<a href="/articles/45.html">04/09/03: Weblog development</a><br />
<a href="/articles/19.html">04/09/03: Dual 1Ghz Ultra Sparc III, 2...</a><br />
<a href="/articles/15.html">02/15/03: Guest Room Painted</a><br />
<a href="/articles/14.html">02/15/03: FTC's national &quot;do not call&quot; re...</a><br />
<a href="/articles/13.html">02/15/03: Unix: Quick and easy to install...</a><br />
<a href="/articles/8.html">02/15/03: The Collapse of Inconvenience</a><br />
<a href="/articles/4.html">02/11/03: Primer Goodness</a><br />
<a href="/articles/7.html">01/18/03: Chicken Dinner</a><br />
<a href="/articles/16.html">01/16/03: Water heater disaster</a><br />
</div> <!-- navList -->
</div> <!-- articleListSheet -->

<p>
</p>

<div id="finePrint">
Steve Kehlet's Pages <br />
Copyright (c) 2003-2014 Steven Kehlet
</div>


</td> <!-- nav -->

<td valign="top"> <!-- content -->

<br />


<div class="newerOlderLinks">
<a href="/articles/187.html">&lt;- 08/14/08: Hello, JRuby Rack and Glass...</a>
 &nbsp;&nbsp;&nbsp;&nbsp; | &nbsp;&nbsp;&nbsp;&nbsp; 
<a href="/articles/185.html">08/07/08: Equal Suffering in JavaScript -&gt;</a>
</div> <!-- newerOlderLinks -->
<div id="sheet" style="overflow: hidden">

<div id="articleHeading">
Handy tcpdump Expression to Gather CDP Information
</div>

<div id="articleSubtitle">
Fri Aug 8th 2008, 12:48pm

</div> <!-- articleSubtitle -->
<div id="articleBody">
This <code>tcpdump</code> command will sniff for Cisco switches' <a
href="http://en.wikipedia.org/wiki/Cisco_Discovery_Protocol">Cisco Discovery Protocol
(CDP)</a> packets.  It's useful to add to your regular arsenal of pings and traceroutes if
you're working on a system on a foreign network of which you were given little to no
information.  Oh, this assumes you have root access of course.  Change <code>eth0</code>
of course to match the network interface(s) you want to examine.  

<br />
<br />

<code>tcpdump -nn -v -i eth0 -s 1500 -c 1 'ether[20:2] == 0x2000'</code>

<br />
<br />

CDP packets offer some additional insight to the network you're on:

<blockquote>
The information contained in CDP announcements varies by the type of device and the
version of the operating system running on it. Information contained includes the
operating system version, hostname, every address for every protocol configured on the
port where CDP frame is sent eg. IP address, the port identifier from which the
announcement was sent, device type and model, duplex setting, VTP domain, native VLAN,
power draw (for Power over Ethernet devices), and other device specific information. 
</blockquote>

You <code>tcpdump</code> output might look something like (IP address XX'd out):

<pre>
14:42:57.087609 CDPv2, ttl: 180s, checksum: 692 (unverified), length 358
      Device-ID (0x01), length: 11 bytes: 'Public_DMZ'
      Address (0x02), length: 13 bytes: IPv4 (1) XXX.XXX.XX.X
      Port-ID (0x03), length: 16 bytes: 'FastEthernet0/21'
      Capability (0x04), length: 4 bytes: (0x00000028): L2 Switch,
IGMP snooping
      Version String (0x05), length: 220 bytes:
        Cisco Internetwork Operating System Software
        IOS (tm) C2950 Software (C2950-I6Q4L2-M), Version 12.1(12c)EA1,
RELEASE SOFTWARE (fc1)
        Copyright (c) 1986-2002 by cisco Systems, Inc.
        Compiled Sun 24-Nov-02 23:31 by antonino
      Platform (0x06), length: 21 bytes: 'cisco WS-C2950G-24-EI'
      Protocol-Hello option (0x08), length: 32 bytes:
      VTP Management Domain (0x09), length: 0 byte: ''
1 packets captured
2 packets received by filter
0 packets dropped by kernel
</pre>
</div>
</div> <!-- sheet -->

<br /><br /><br />
<div id="postingsSheet">
<div class="postingHeader">
Visitor comments
</div>
<div class="posting">
<div class="postingHeading">
On Mon Aug 11th 2008, 12:50pm, Oscar posted:
</div>
<div class="postingBody">
I tried this at my office and it only found my Cisco 7940 Series phone
(which is technically a switch?). This was my output (OS X 10.5.4)<br />
<br />
$ sudo tcpdump -nn -v -i en0 -s 1500 -c 1 'ether[20:2] == 0x2000'<br />
<br />
tcpdump: listening on en0, link-type EN10MB (Ethernet), capture size 1500
bytes<br />
11:46:33.265286 CDPv2, ttl: 180s, checksum: 692 (unverified), length
115<br />
	Device-ID (0x01), length: 15 bytes: 'SEPXX146XXXXXXX'<br />
	Address (0x02), length: 13 bytes: IPv4 (1) XX.XX.X.XXX<br />
	Port-ID (0x03), length: 6 bytes: 'Port 2'<br />
	Capability (0x04), length: 4 bytes: (0x00000090): L3 capable<br />
	Version String (0x05), length: 12 bytes: <br />
	  P00307020200<br />
	Platform (0x06), length: 19 bytes: 'Cisco IP Phone 7940'<br />
	Native VLAN ID (0x0a), length: 2 bytes: 3<br />
	Duplex (0x0b), length: 1 byte: full<br />
	ATA-186 VoIP VLAN request (0x0e), length: 3 bytes: app 1, vlan 20<br />
1 packets captured<br />
440 packets received by filter<br />
0 packets dropped by kernel<br />
<br />
Does this mean that if there are other switches beyond my own switch (in
this case the Cisco phone) I won't see them?<br />
<br />

</div><!-- postingBody -->
</div><!-- posting -->
<br />
<br />

<div class="posting">
<div class="postingHeading">
On Mon Aug 11th 2008, 2:05pm, Steve Kehlet posted:
</div>
<div class="postingBody">
Yup, that's exactly right.<br />

</div><!-- postingBody -->
</div><!-- posting -->
<br />
<br />

<div class="posting">
<div class="postingHeading">
On Wed Aug 27th 2008, 9:49am, Oscar posted:
</div>
<div class="postingBody">
without some fancy scanning network tool, is there a way to go beyond the
first switch I mentioned?<br />

</div><!-- postingBody -->
</div><!-- posting -->
<br />
<br />

<div class="posting">
<div class="postingHeading">
On Wed Aug 27th 2008, 9:49am, Oscar posted:
</div>
<div class="postingBody">
without some fancy scanning network tool, is there a way to go beyond the
first switch I mentioned?<br />

</div><!-- postingBody -->
</div><!-- posting -->
<br />
<br />

<div class="posting">
<div class="postingHeading">
On Wed Aug 27th 2008, 9:50am, Oscar posted:
</div>
<div class="postingBody">
Sorry for the double-post... and quick question... you got any plans to add
a &quot;check to receive follow ups&quot; to comments option on your
site?<br />

</div><!-- postingBody -->
</div><!-- posting -->
<br />
<br />

<div class="posting">
<div class="postingHeading">
On Wed Aug 27th 2008, 10:34am, Steve Kehlet posted:
</div>
<div class="postingBody">
Cisco switches can mirror remote ports (&quot;remote SPAN&quot;), so you
can see traffic on other switches that way.  You'll need administrative
access to all switches in question, of course.<br />
<br />
Yeah, I hope to get a whole new blog engine, Really Soon Now :-).<br />
<br />
<br />

</div><!-- postingBody -->
</div><!-- posting -->
<br />
<br />

<div class="posting">
<div class="postingHeading">
On Wed Aug 12th 2009, 12:24am, Visitor posted:
</div>
<div class="postingBody">
RE : the phone. Disconnect the phone, plug directly into the wall-outlet.
<br />

</div><!-- postingBody -->
</div><!-- posting -->
<br />
<br />

<div class="posting">
<div class="postingHeading">
On Tue Jul 6th 2010, 11:35am, Visitor posted:
</div>
<div class="postingBody">
any way to do this with bonded interfaces to see where the physicals are
connected?<br />

</div><!-- postingBody -->
</div><!-- posting -->
<br />
<br />

<div class="posting">
<div class="postingHeading">
On Fri Mar 11th 2011, 12:21am, d posted:
</div>
<div class="postingBody">
Late response, but, to the previous visitor... From Steve's example above,
replace eth0 with bond0 (or whichever bond interface you want) and -c 1
with -c &lt;number of bonded interfaces&gt; and away you go, you capture
one cdp packet per interface.<br />

</div><!-- postingBody -->
</div><!-- posting -->
<br />
<br />

<div class="posting">
<div class="postingHeading">
On Thu May 19th 2011, 3:13pm, -gre posted:
</div>
<div class="postingBody">
... unless of course, the bond is active/passive, in which case you have to
fail over the bond and capture twice, i.e.<br />
<br />
ifenslave -c bond0 &lt;slave if 1&gt;<br />
tcpdump ...<br />
ifenslave -c bond0 &lt;slave if 2&gt;<br />
tcpdump ...<br />
<br />

</div><!-- postingBody -->
</div><!-- posting -->
<br />
<br />

<div class="posting">
<div class="postingHeading">
On Tue Oct 15th 2013, 7:59pm, Visitor posted:
</div>
<div class="postingBody">
responding to the last comment: or you can just individually tcpdump on
each of the bonds' slaves.<br />

</div><!-- postingBody -->
</div><!-- posting -->
<br />
<br />

</div> <!-- postingsSheet -->
<br />
<br />
<div class="newerOlderLinks">
<a href="/articles/187.html">&lt;- 08/14/08: Hello, JRuby Rack and Glass...</a>
 &nbsp;&nbsp;&nbsp;&nbsp; | &nbsp;&nbsp;&nbsp;&nbsp; 
<a href="/articles/185.html">08/07/08: Equal Suffering in JavaScript -&gt;</a>
</div> <!-- newerOlderLinks -->


</td> <!-- content -->

</tr>
</table> <!-- main layout -->

<!-- Google Analytics -->
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-3386315-1");
pageTracker._initData();
pageTracker._trackPageview();
</script>

</body>
</html>

<!-- Generated on 2014/09/07 11:29am -->